<?xml version="1.0" encoding="UTF-8"?>
<section>
  <title>Build</title>

  <section>
    <title>Building the Source</title>

    <para>Now that we have the source the next step is to build and install
    the source. We do this with</para>

    <para>Since version 3.1 Drools uses <indexterm>
        <primary>maven2</primary>
      </indexterm> as default to build the system. There are two profiles
    available which enable the associated modules "documentation" and
    "eclipse"; this enables quicker building of the core modules for
    developers. The eclipse profile will download eclipse into the
    drools-eclipse folder, which is over 100MB download, however this only
    needs to be done once; if you wish you can move that eclipse download into
    another location and specify it with
    -DlocalEclipseDrop=/folder/jboss-rules/local-eclipse-drop-mirror. The
    following builds all the jars, the documentation and the eclipse zip with
    a local folder specified to avoid downloading eclipse:</para>

    <para><programlisting>mvn -Declipse=true -Ddocumentation=true clean install -DlocalEclipseDrop=/folder/jboss-rules/local-eclipse-drop-mirror </programlisting></para>

    <para>You can produce distribution builds, which puts everything into
    zips, as follows:<programlisting>mvn -Declipse=true -Ddocumentation=true clean install -DlocalEclipseDrop=/folder/jboss-rules/local-eclipse-drop-mirror

mvn -Ddocumentation -Declipse -Dmaven.test.skip package javadoc:javadoc assembly:assembly -DlocalEclipseDrop=/folder/jboss-rules/local-eclipse-drop-mirror
    </programlisting></para>

    <para>Note that install must be done first as javadoc:javadoc won't work
    unless the jars are in the local maven repo, but the tests can be skipped
    on the second run. assembly:assembly fails unless you increase the
    available memory to Maven, on windows the following command worked well:
    set MAVEN_OPTS=-Xmx512m</para>

    <para>Type mvn clean to clear old artifacts, and then test and built the
    source, and report on any errors.</para>

    <para>The resulting jars are put in the /target directory from the top
    level of the project.</para>

    <para>As maven builds each module it will install the resulting jars in
    the local Maven 2 repository automatically. Where it can be easily used
    from other project <literal>pom.xml</literal> or copied else where.</para>

    <screenshot>
      <screeninfo>Installed Drools Jars</screeninfo>

      <mediaobject>
        <imageobject>
          <imagedata fileref="mvn_install4.jpg" />
        </imageobject>
      </mediaobject>
    </screenshot>
  </section>

  <section>
    <title>Building the Manual</title>

    <para>Drools uses <indexterm>
        <primary>docbook</primary>
      </indexterm>Docbook for this manual. Ant is used to build the
    documentation. The documentation produces four different formats, all
    share the same images directory. PDFs will attempt to use SVG images where
    possible.</para>

    <itemizedlist>
      <listitem>
        <para>html_single</para>

        <para>The entire manual in a single html document</para>
      </listitem>

      <listitem>
        <para><indexterm>
            <primary>html</primary>
          </indexterm>html</para>

        <para>The manual is split into multiple documents and placed in a
        frameset. The left frame provides navigation</para>
      </listitem>

      <listitem>
        <para><indexterm>
            <primary>pdf</primary>
          </indexterm>PDF (currently broken, due to layout issues with image
        sizes)</para>

        <para>A generated PDF, with nagivation.</para>
      </listitem>

      <listitem>
        <para>eclipse</para>

        <para>Documentation suitable for including in an eclipse plugin</para>
      </listitem>
    </itemizedlist>

    <para>The manual can be generated from the project root's build.xml by
    calling <literal>'ant manual'</literal>, with the generated documentation
    being copied to <literal>'target/docs'</literal>. What actually happens is
    a call to a separate ant build.xml for the manual, located at
    <literal>documentation/manual</literal>; the documentation is generated
    into <literal>documentation/manual/build</literal> before being copied to
    <literal>'target/docs'.</literal><figure>
        <title>Generating the Manual with Ant</title>

        <programlisting>C:\dev\jbossrules&gt;ant manual
Buildfile: build.xml

manual:
   [delete] Deleting directory D:\dev\jbossrules\documentation\manual\build

clean:

all.doc:

lang.all:

lang.misc:
     [copy] Copying 102 files to C:\dev\jbossrules\documentation\manual\build\en\shared\images
     [copy] Copying 1 file to C:\dev\jbossrules\documentation\manual\build\en\shared\css
    [style] Transforming into C:\dev\jbossrules\documentation\manual\build\en\shared\images
    [style] Processing C:\dev\jbossrules\documentation\manual\en\Chapter-Papers\guests_at_table.svg to C:\dev\jbossrules
\documentation\manual\build\en\shared\images\Chapter-Papers\guests_at_table.svg
    [style] Loading stylesheet C:\dev\jbossrules\documentation\manual\en\styles\visio_svg.xsl
    [style] Processing C:\dev\jbossrules\documentation\manual\en\Chapter-Papers\make_path.svg to C:\dev\jbossrules\docum
entation\manual\build\en\shared\images\Chapter-Papers\make_path.svg
    [style] Processing C:\dev\jbossrules\documentation\manual\en\Chapter-Papers\manners_activity_diagram.svg to C:\dev\j
bossrules\documentation\manual\build\en\shared\images\Chapter-Papers\manners_activity_diagram.svg
    [style] Processing C:\dev\jbossrules\documentation\manual\en\Chapter-Performance_Tuning\beta_node.svg to C:\dev\jbos
...
snip
...
lang.dochtml:
    [mkdir] Created dir: C:\dev\jbossrules\documentation\manual\build\en\html
     [copy] Copying 1 file to C:\dev\jbossrules\documentation\manual\build\en\html
     [java] Writing bk01-toc.html for book
     [java] Writing pr01.html for preface(preface)
     [java] ID recommended on part: Reference Manual
     [java] ID recommended on chapter: The Rule Engine
     [java] ID recommended on section: What is a Rule Engine
     [java] ID recommended on section: Background
     [java] ID recommended on figure: Inference Engine
     [java] ID recommended on figure: SQL as a simplistic Inference Engine
     [java] ID recommended on figure: Additional Reading
     [java] ID recommended on section: Rules
     [java] ID recommended on figure: A Basic Rete network
     [java] ID recommended on figure: A Basic Rete network
...
snip
...
lang.dochtmlsingle:
    [mkdir] Created dir: C:\dev\jbossrules\documentation\manual\build\en\html_single
     [java] ID recommended on part: Reference Manual
     [java] ID recommended on chapter: The Rule Engine
     [java] ID recommended on section: What is a Rule Engine
     [java] ID recommended on section: Background
     [java] ID recommended on figure: Inference Engine
     [java] ID recommended on figure: SQL as a simplistic Inference Engine
     [java] ID recommended on figure: Additional Reading
     [java] ID recommended on section: Rules
     [java] ID recommended on figure: A Basic Rete network
     [java] ID recommended on figure: A Basic Rete network
     [java] ID recommended on section: Why use a Rule Engine
...
snip
...
     [java] ID recommended on section: Make Path and Path Done
     [java] ID recommended on figure: Rete Diagram
     [java] ID recommended on section: Continue and Are We Done
     [java] ID recommended on section: Conclusion
     [java] ID recommended on section: Output Summary
     [java] ID recommended on index
     [copy] Copying 142 files to C:\dev\jbossrules\target\docs

BUILD SUCCESSFUL
Total time: 54 seconds
C:\dev\jbossrules&gt;</programlisting>
      </figure></para>

    <para>The generated manual can be found in the
    <literal>target\docs</literal> directory, a folder per each format.</para>

    <screenshot>
      <screeninfo>Generated documentation</screeninfo>

      <mediaobject>
        <imageobject>
          <imagedata fileref="manual4.jpg" />
        </imageobject>
      </mediaobject>
    </screenshot>

    <para>The manual was first generated into the manual's
    <literal>build</literal> directory, as shown below, before being copied
    across.</para>

    <screenshot>
      <screeninfo>Generated documentation</screeninfo>

      <mediaobject>
        <imageobject>
          <imagedata fileref="manual3.jpg" />
        </imageobject>
      </mediaobject>
    </screenshot>
  </section>
</section>